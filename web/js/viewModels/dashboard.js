define(["knockout","jquery","utils/dom","ojs/ojcore","ojs/ojarraydataprovider","ojs/ojcollectiontabledatasource","ojs/ojlistview","ojs/ojlistitemlayout","ojs/ojbutton","ojs/ojoption","ojs/ojcollapsible","ojs/ojdialog"],function(e,t,r,i,s){return function(){return new class{constructor(){this.handleActivated=function(t){this._controller=t.valueAccessor().params.app,this.openData=e.pureComputed(()=>JSON.stringify(this._controller.openData(),null,4)),this.isViewable=e.observable(!1),this.laborItems=this._controller.laborItems,this.expenseItems=this._controller.expenseItems,this.usedPartsCollection=this._controller.usedPartsCollection,this.returnedPartsCollection=this._controller.returnedPartsCollection,this.laborDataProvider=new s(this.laborItems,{idAttribute:"id"}),console.log("Labor Items:"+this.laborItems),this.expenseDataProvider=new s(this.expenseItems,{idAttribute:"id"}),this.usedPartsObservableArray=e.observableArray(this._getUsedPartsArray()),this.usedPartsDataSource=new s(this.usedPartsObservableArray,{idAttribute:"id"}),this.returnedPartsObservableArray=e.observableArray(this._getReturnedPartsArray()),this.returnedPartsDataSource=new s(this.returnedPartsObservableArray,{idAttribute:"id"}),this._activityModel=this._controller.ofscActivityModel,this.dialogHeading=e.observable(""),this.currentItemId=e.observable(""),this.emptyDashboard=e.pureComputed(()=>this.laborItems().length>0||this.expenseItems().length>0||this.usedPartsObservableArray().length>0||this.returnedPartsObservableArray().length>0),this.menuItemAction=(e=>{this.selectedMenuItem(e.detail.selectedValue)}),this.selectedMenuItem=e.observable(""),this.selectedMenuItem.subscribe(e=>{if("labor"===e)this._controller.router.go("add-labor");else{if("addParts"===e)return this._controller.router.go("add-used-part");if("returnParts"===e)return this._controller.router.go("add-returned-part");if("expenses"===e)return this._controller.router.go("add-expense");if("serviceChecklist"===e)return this._controller.router.go("service-checklist")}})},this.handleAttached=function(e){},this.handleBindingsApplied=function(e){r.resetScrolling()},this.handleDetached=function(e){}}closeDialog(){document.getElementById("modalDialog").close()}openDialog(e,t,r){var i="";"labor"===e||"expenses"===e?i=r.data.item_label:"usedParts"!==e&&"returnParts"!==e||(i=this.getpopupMessage(r)),this.dialogHeading("Remove "+i+"?"),r.data.inventory&&""!==r.data.inventory.get("invsn")?this.currentItemId(t.currentTarget.id+","+r.data.inventory.attributes.invsn):this.currentItemId(t.currentTarget.id),document.getElementById("modalDialog").open()}getpopupMessage(e){return null!=e.data.inventory.get("invsn")&&""!=e.data.inventory.get("invsn")?e.data.id.concat(" (",e.data.inventory.get("invsn"),")"):e.data.id.concat(" (",e.data.measuredQuantity,")")}deleteSelectedItem(e){var t=e.currentTarget.id,r=t.split(","),i=r[0],s=r[1],o=r[2];"labor"===s?this.removeSelectedLabors(+i):"expenses"===s?this.removeSelectedExpenses(+i):"usedParts"===s?o&&"null"!==o?this.removeSelectedUsedParts(i,o):this.removeSelectedUsedParts(i,null):"returnParts"===s&&(o&&"null"!==o?this.removeSelectedReturnedParts(i,o):this.removeSelectedReturnedParts(i,null)),this.closeDialog()}_getUsedPartsArray(){return this.usedPartsCollection.filter(e=>(parseInt(e.get("quantity",10))||0)>=1).map(e=>this.getInventoryViewModel(e))}_getReturnedPartsArray(){return this.returnedPartsCollection.filter(e=>(parseInt(e.get("quantity",10))||0)>=1).map(e=>this.getInventoryViewModel(e))}getInventoryViewModel(e){let t="";return this._controller.attributeDescription.part_uom_code&&this._controller.attributeDescription.part_uom_code.enum&&this._controller.attributeDescription.part_uom_code.enum[e.get("part_uom_code")]&&(t=this._controller.attributeDescription.part_uom_code.enum[e.get("part_uom_code")].text),""!==t&&(t=" "+t),{id:e.get("part_item_number_rev"),inventory:e,serviceActivityUsed:e.get("part_service_activity_used")&&this._controller.attributeDescription.part_service_activity_used.enum[e.get("part_service_activity_used")]&&this._controller.attributeDescription.part_service_activity_used.enum[e.get("part_service_activity_used")].text,serviceActivityReturned:e.get("part_service_activity_returned")&&this._controller.attributeDescription.part_service_activity_returned.enum[e.get("part_service_activity_returned")]&&this._controller.attributeDescription.part_service_activity_returned.enum[e.get("part_service_activity_returned")].text,measuredQuantity:`${e.get("quantity")}${t}`,dispositionText:e.get("part_disposition_code")&&this._controller.attributeDescription.part_disposition_code&&this._controller.attributeDescription.part_disposition_code.enum&&this._controller.attributeDescription.part_disposition_code.enum[e.get("part_disposition_code")]&&this._controller.attributeDescription.part_disposition_code.enum[e.get("part_disposition_code")].text}}removeSelectedUsedParts(e,t){this._controller.removeUsedPart(e,t),this.usedPartsObservableArray(this._getUsedPartsArray())}removeSelectedReturnedParts(e,t){this._controller.removeReturnedPart(e,t),this.returnedPartsObservableArray(this._getReturnedPartsArray())}onCloseButtonClick(){this._controller.terminatePlugin()}onPreviewInvoiceButtonClick(){this._controller.router.go("invoice")}onSaveButtonClick(){this._activityModel.unset("csign"),this._activityModel.unset("invoice"),this._controller.submitPluginData()}addLabor({activityId:e,itemId:t,startTime:r,endTime:i}){return this._controller.addLabor({activityId:e,itemId:t,startTime:r,endTime:i})}removeSelectedLabors(e){this._controller.removeLabor(e)}removeSelectedExpenses(e){this._controller.removeExpense(e)}formatDuration(e){return~~(e/60)+":"+("0"+e%60).slice(-2)}}}});