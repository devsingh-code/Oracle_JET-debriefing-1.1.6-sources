"use strict";define(["knockout","utils/dom","ojs/ojarraydataprovider","ojs/ojmutablearraydataprovider","ojs/ojlistview","ojs/ojbutton","ojs/ojtable"],function(t,e,i,a){return function(){return this.mainSectionClass=t.observable(),new class{async fetchData(t){const e=t;let i;try{const t=await fetch(e);if(!t.ok)throw Error(t.message);i=await t.json()}catch(e){throw Error(t.message)}return i}initializeobservables(){this.remarksValue=t.observable(),this.warrantyValue=t.observable(),this.isWarrantyDisabled=t.observable(!0),this.inputWarrantyDataProvider=t.observable(new i([],{keyAttributes:"value"})),this.inputBrandDataProvider=t.observable(new i([],{keyAttributes:"value"})),this.inputTypeDataProvider=t.observable(new i([],{keyAttributes:"value"})),this.inputModelDataProvider=t.observable(new i([],{keyAttributes:"value"})),this.warrantyDataProvider=t.observable(new i([],{keyAttributes:"type"})),this.previousAssetdataProvider=t.observable(new i([],{keyAttributes:"date"})),this.previousRemarksId=t.observable(),this.inputSucDateValue=t.observable(),this.isSucDateDisabled=t.observable(!1),this.inputDeliveryDateValue=t.observable(),this.isDeliverDateDisabled=t.observable(!1),this.modelValue=t.observable(),this.isModelDisabled=t.observable(!1),this.typeValue=t.observable(),this.isTypeDisabled=t.observable(!1),this.brandValue=t.observable(),this.isBrandDisabled=t.observable(!1),this.serialNumberValue=t.observable(),this.isSerialNumberDisabled=t.observable(!0),this.assetTagNumberValue=t.observable(),this.isAssetNumberDisabled=t.observable(!0)}createId(t,e){var i=[];return i.assetDetailsId="assetMappingBtn_"+t+"_"+e,i.serviceCheckListId="nextButton_"+t+"_"+e,i.prevHistoryId="prevHistoryDiv_"+t+"_"+e,i}listallAssets(e){var a=1;this.allAssetData=[],this.allAssetsDataProvider=t.observable(new i([],{keyAttributes:"serialNo"}));const s=e.inventoryList;console;for(const[t,i]of Object.entries(s)){var n=null!=e.activity.masterActivityId?e.activity.masterActivityId:"";if("customer"==i.invpool&&i.inv_aid==e.activity.aid||"customer"==i.invpool&&i.inv_aid==n){var r=i.invid,l=i.osc_asset_id,o=(null!=i.inv_capacity&&i.inv_capacity.length>0&&i.inv_capacity,null!=i.model_name&&i.model_name.length>0?i.model_name:""),v=(null!=e.activity.activity_organization&&e.activity.activity_organization.length>0&&e.activity.activity_organization,null!=i.inv_floor&&i.inv_floor.length>0?i.inv_floor:"NA"),y=null!=i.inv_room&&i.inv_room.length>0?i.inv_room:"NA",c=null!=i.inv_block&&i.inv_block.length>0?i.inv_block:"NA",u=null!=i.inv_type&&i.inv_type.length>0?i.inv_type:"",h=(null!=i.inv_visitNumber&&i.inv_visitNumber.length>0&&i.inv_visitNumber,null!=i.inv_number&&i.inv_number.length>0?i.inv_number:"NA"),d=null!=i.invsn&&i.invsn.length>0?i.invsn:"",b=null!=i.issue_type&&i.issue_type.length>0?i.issue_type:"NA",_=null!=i.inv_service_type&&i.inv_service_type.length>0?i.inv_service_type:"NA",p=null!=i.asset_remarks&&i.asset_remarks.length>0?i.asset_remarks:"NA",m=null!=i.warranty&&i.warranty.length>0?i.warranty:"NA";m="yes"==m?"Active":"Expired",1!=i.asset_verified?1!=i.service_checklist_completed&&(this.assetClass="demo-centering-box-red"):1!=i.service_checklist_completed?this.assetClass="demo-centering-box-yellow":this.assetClass="demo-centering-box-green";var g=this.createId(r,l);0==this.allAssetData.length?this.allAssetData=[{model:o,serialNo:d,wStatus:m,block:c,floor:v,room:y,machineNo:h,assetType:u,issueType:b,serviceType:_,remarks:p,count:a,assetMappingButtonId:g.assetDetailsId,serviceCheckListButtonId:g.serviceCheckListButtonId,serviceCheckListHistoryId:g.prevHistoryId}]:this.allAssetData.push({model:o,serialNo:d,wStatus:m,block:c,floor:v,room:y,machineNo:h,assetType:u,issueType:b,serviceType:_,remarks:p,count:a,assetMappingButtonId:g.assetDetailsId,serviceCheckListButtonId:g.serviceCheckListButtonId,serviceCheckListHistoryId:g.prevHistoryId}),a++}}"Preventive Maintenance"!=e.activity.aworktype&&this.allAssetsDataProvider(new i(this.allAssetData,{keyAttributes:"serialNo"}))}assetMapping(e,a,s){var e=e,n=new Date,r=n.getDate(),l=n.getMonth()+1;n.getFullYear(),l<10&&(l="0"+l),r<10&&(r="0"+r),null!=s.activity.activity_organization&&s.activity.activity_organization.length>0&&s.activity.activity_organization,null!=s.activity.project&&s.activity.project.length>0&&s.activity.project,null!=s.activity.caddress&&s.activity.caddress.length>0&&s.activity.caddress,null!=s.activity.reference_number&&s.activity.reference_number.length>0&&s.activity.reference_number,null!=s.activity.caddress&&s.activity.caddress.length>0&&s.activity.caddress;var o=null!=s.inventoryList[e].model_name&&s.inventoryList[e].model_name.length>0?s.inventoryList[e].model_name:"",v=null!=s.inventoryList[e].inv_type&&s.inventoryList[e].inv_type.length>0?s.inventoryList[e].inv_type:"",y=(null!=s.inventoryList[e].inv_block&&s.inventoryList[e].inv_block.length>0&&s.inventoryList[e].inv_block,null!=s.inventoryList[e].inv_floor&&s.inventoryList[e].inv_floor.length>0&&s.inventoryList[e].inv_floor,null!=s.inventoryList[e].inv_number&&s.inventoryList[e].inv_number.length>0&&s.inventoryList[e].inv_number,null!=s.inventoryList[e].invsn&&s.inventoryList[e].invsn.length>0?s.inventoryList[e].invsn:""),c=null!=s.inventoryList[e].brand&&s.inventoryList[e].brand.length>0?s.inventoryList[e].brand:"",u=(null!=s.inventoryList[e].capacity&&s.inventoryList[e].capacity.length>0&&s.inventoryList[e].capacity,null!=s.inventoryList[e].delivery_date&&s.inventoryList[e].delivery_date.length>0?s.inventoryList[e].delivery_date:""),h=null!=s.inventoryList[e].suc_date&&s.inventoryList[e].suc_date.length>0?s.inventoryList[e].suc_date:"",d=(null!=s.inventoryList[e].type&&s.inventoryList[e].type.length>0&&s.inventoryList[e].type,null!=s.inventoryList[e].warranty&&s.inventoryList[e].warranty.length>0?s.inventoryList[e].warranty:""),b=(null!=s.inventoryList[e].issue_type&&s.inventoryList[e].issue_type.length>0&&s.inventoryList[e].issue_type,null!=s.inventoryList[e].inv_service_type&&s.inventoryList[e].inv_service_type.length>0&&s.inventoryList[e].inv_service_type,null!=s.inventoryList[e].asset_remarks&&s.inventoryList[e].asset_remarks.length>0&&s.inventoryList[e].asset_remarks,null!=s.inventoryList[e].warranty_start_date&&s.inventoryList[e].warranty_start_date.length>0&&s.inventoryList[e].warranty_start_date,null!=s.inventoryList[e].warranty_end_date&&s.inventoryList[e].warranty_end_date.length>0&&s.inventoryList[e].warranty_end_date,null!=s.inventoryList[e].inv_warranty_info&&s.inventoryList[e].inv_warranty_info.length>0?s.inventoryList[e].inv_warranty_info:""),_=null!=s.inventoryList[e].inv_number&&s.inventoryList[e].inv_number.length>0?s.inventoryList[e].inv_number:"";this.serialNumberValue(y),this.assetTagNumberValue(_),this.brandArray=[{value:c||"Select Brand",label:c||"Select Brand"}],this.typeArray=[{value:v||"Select Type",label:v||"Select Type"}],this.modelArray=[{value:o||"Select Model",label:o||"Select Model"}],this.warrantyArray=[{value:d||"Select Warranty",label:d||"Select Warranty"},{value:"Not in wARRANTY",label:"No warranty"}];var p="prevRemarks_"+a;this.previousRemarksId(p),this.inputBrandDataProvider=t.observable(new i(this.brandArray,{keyAttributes:"value"})),this.inputTypeDataProvider(new i(this.typeArray,{keyAttributes:"value"})),this.inputModelDataProvider(new i(this.modelArray,{keyAttributes:"value"})),this.inputWarrantyDataProvider(new i(this.warrantyArray,{keyAttributes:"value"})),""!=u&&(this.inputDeliveryDateValue(u),this.isDeliverDateDisabled(!0)),""!=h&&(this.inputSucDateValue(h),this.isSucDateDisabled(!0)),this.generateWarrantyTable(e,b,s),1==s.inventoryList[e].asset_shutdown?this.assetShutdownValue=t.observableArray([1]):this.assetShutdownValue=t.observableArray([])}generateWarrantyTable(t,e,a){if(this.warrantyData=[],""!=e){var s=JSON.parse(e);if("Carrier"==a.inventoryList[t].brand||"Toshiba"==a.inventoryList[t].brand)if(s.warranty.length>0){for(const[t,e]of Object.entries(s.warranty)){var n=new Date(e.w_start),n=new Date(e.w_start),r=n.getDate(),l=n.getMonth()+1,o=n.getUTCFullYear().toString().substr(-2);l<10&&(l="0"+l),r<10&&(r="0"+r);var v=l+"/"+r+"/"+o;v.includes("NaN")&&(v="Not Available");var n=new Date(e.w_end),r=n.getDate(),l=n.getMonth()+1,o=n.getUTCFullYear().toString().substr(-2);l<10&&(l="0"+l),r<10&&(r="0"+r);var y=l+"/"+r+"/"+o;y.includes("NaN")&&(y="Not Available");var c=v+" - "+y,n=new Date(e.c_end),r=n.getDate(),l=n.getMonth()+1,o=n.getUTCFullYear().toString().substr(-2);l<10&&(l="0"+l),r<10&&(r="0"+r);var u=l+"/"+r+"/"+o;u.includes("NaN")&&(u="Not Available"),0==this.warrantyData.length?this.warrantyData=[{type:e.type,startEnd:c,compEnd:u}]:this.warrantyData.push({type:e.type,startEnd:c,compEnd:u})}this.warrantyDataProvider(new i(this.warrantyData,{keyAttributes:"type"}))}else console.log("Add section for warranty not available")}}handleActivated(e){this._controller=e.valueAccessor().params.app,this.ofscData=this._controller.openData(),console.log(this.ofscData),this.count=t.observable(),this.listallAssets(this.ofscData),this.assetData=[{account:null!=this.ofscData.activity.activity_organization&&this.ofscData.activity.activity_organization.length>0?this.ofscData.activity.activity_organization:"",site:null!=this.ofscData.activity.caddress&&this.ofscData.activity.caddress.length>0?this.ofscData.activity.caddress:"",refno:null!=this.ofscData.activity.reference_number&&this.ofscData.activity.reference_number.length>0?this.ofscData.activity.reference_number:""}],this.assetDataProvider=t.observable(new i(this.assetData,{keyAttributes:"account"}))}handleAttached(t){console.log("Page is Loaded "),this._controller=t.valueAccessor().params.app,this.initializeobservables(),this.ofscData=this._controller.openData(),console.log(this.ofscData),this._doc=document.getElementById("mainSectionPanel"),this._assetDoc=document.getElementById("assetVerifySectionPanel"),this._modalPanel=document.getElementById("previousAssetDialog"),this.assetButtonAction=function(t){this._doc.classList.add("ishidden"),this._assetDoc.classList.remove("ishidden");var e=t.target.id,i=e.split("_"),a=i[1];this.assetId=i[2],this.assetMapping(a,this.assetId,this.ofscData)}.bind(this),this.modalOpener=async function(t){var e=t.target.id,a=e.split("_");this.assetId=a[1];var s=this.ofscData.securedData.url+"/ofs_previous_service_history.php?action=fetch_remark&assets_id="+this.assetId;let n=await this.fetchData(s);n=n.data.remark_history;for(let t=0;t<n.length;t++)0==t?this.prevRemarksData=[{date:n[t].date,technician:n[t].technician,remarks:n[t].Remarks,ref_num:n[t].ref_num?n[t].ref_num:"NA"}]:this.prevRemarksData.push({date:n[t].date,technician:n[t].technician,remarks:n[t].Remarks,ref_num:n[t].ref_num?n[t].ref_num:"NA"});this.previousAssetdataProvider(new i(this.prevRemarksData,{keyAttributes:"date"})),this._modalPanel.open()}.bind(this)}}}});